1. Watermark就是事件时间，代表当前时间的进展

2. Watermark主要用来处理乱序数据，一般就是直接定义一个延迟时间，延迟触发窗口操作
这里的延迟，指的是当前收到的数据内的时间戳

3. Watermark延迟时间的设置，一般要根据数据的乱序情况来定，通常设置成最大乱序程度
如果按照最大乱序程度定，那么就能保证所有窗口的数据都是正确的
要权衡正确性和实时性的话，可以不按最大乱序程度，而是给一个相对较小的watermark延迟
watermark延迟时间，完全是程序自己定义的，可以拍脑袋给一个数
最好的处理方式，是先了解数据的分布情况（抽样、或者根据经验、机器学习算法），可以指定一个合理的延迟，比较小，还能处理绝大多数乱序的情况

4. 关窗操作，必须是时间进展到窗口关闭时间，事件时间语义下就是watermark达到窗口关闭时间
当前Ts最大时间戳-延迟时间 = watermark，如果现在的watermark大于等于窗口结束时间，就关闭窗口

5. watermark代表的含义是，之后就不会再来时间戳比wate  rmark里面的数值小的数据了
如果有不同的上游分区，当前任务会对它们创建各自的分区watermark，当前任务的事件时间就是最小的那个

6. 处理乱序数据，Flink有三重保证
watermark可以设置延迟时间
window的allowedLateness方法，可以设置窗口允许处理迟到数据的时间
window的sideOutputLateData方法，可以将迟到的数据写入侧输出流

窗口有两个重要操作：触发计算，清空状态（关闭窗口）


watermark是一条特殊的数据记录
watermark必须是单调递增，以确保任务的事件时间时钟在向前推进，而不是在后退
watermark与数据的时间戳相关